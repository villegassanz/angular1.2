(function(){
    'use strict';
    angular
        .module("tbcAngular")
        .factory('servicioalumno', dataservice);
        function dataservice($http,$q){
            var service = {
                getAlumno: getAlumno,
                getAlumnoById: getAlumnoById,
                updateAlumno: updateAlumno,
                addAlumno: addAlumno,
                eliminar: eliminar,
                getInfoCodigoPostal: getInfoCodigoPostal,
                login: login
            };
            return service;
        function getInfoCodigoPostal(cp){
            var defered = $q.defer();   
                var promise = defered.promise;
                $http.get('https://api-codigos-postales.herokuapp.com/v2/codigo_postal/'+cp)
                    .success(exito)
                    .error(intenta_de_nuevo);

                    function exito(response){
                        defered.resolve(response);

                    }

                    function intenta_de_nuevo(err){
                         defered.reject(err)
                    }   
                    return promise;
        }    
        function getAlumno() {
                var defered = $q.defer();
                var promise = defered.promise;
                $http.get('http://localhost/angular1.2/backend/public/api/alumnos')
                    .success(exito)
                    .error(intenta_de_nuevo);

                    function exito(response){
                        defered.resolve(response);
                    }

                    function intenta_de_nuevo(err){
                         defered.reject(err)
                    }   
                    return promise;                   
            }
        function eliminar(id){
            var defered = $q.defer();
                var promise = defered.promise;
                $http.put('http://localhost/angular1.2/backend/public/api/alumnos/delete/'+id)
                    .success(exito)
                    .error(intenta_de_nuevo);

                    function exito(response){
                        defered.resolve(response);
                    }

                    function intenta_de_nuevo(err){
                         defered.reject(err)
                    }   
                    return promise;    
        }
            function login(user, password) {
                var defered = $q.defer();
                var promise = defered.promise;
                $http.get('http://localhost/angular1.2/backend/public/api/alumnos/login/'+user+'/password/'+password)
                    .success(exito)
                    .error(intenta_de_nuevo);

                    function exito(response){
                        defered.resolve(response);
                    }

                    function intenta_de_nuevo(err){
                         defered.reject(err)
                    }   
                    return promise;                   
            }
            function getAlumnoById(id){
                var defered = $q.defer();
                var promise = defered.promise;
                $http.get('http://localhost/angular1.2/backend/public/api/alumnos/'+id)
                    .success(exito)
                    .error(intenta_de_nuevo);
                    function exito(response){
                        defered.resolve(response);

                    }

                    function intenta_de_nuevo(err){
                         defered.reject(err)
                    }   
                    return promise;
            }
            function updateAlumno(obj){
                var defered = $q.defer();
                var promise = defered.promise;
                $http.put('http://localhost/angular1.2/backend/public/api/alumnos/update/'+obj.id_alumno, obj)
                    .success(exito)
                    .error(intenta_de_nuevo);
                    function exito(response){
                        defered.resolve(response);
                    }
                    function intenta_de_nuevo(err){
                         defered.reject(err)
                    }   
                    return promise;
            }
            function addAlumno(obj){
                var defered = $q.defer();
                var promise = defered.promise;
                $http.post('http://localhost/angular1.2/backend/public/api/alumnos',obj)
                    .success(exito)
                    .error(intenta_de_nuevo);
                    function exito(response){
                        defered.resolve(response);
                    }

                    function intenta_de_nuevo(err){
                        defered.reject(err)
                    }   
                    return promise;
            }

           
            
        }

})();
