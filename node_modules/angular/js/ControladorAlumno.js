(function() {
    angular.module("tbcAngular").controller("AlumnoCtrl", AlumnoController);

    function AlumnoController(servicioalumno, $state) {
        var vm = this;
        vm.getAlumnos = getAlumnos;
        vm.getAlumnoById = getAlumnoById;
        vm.updateAlumno = updateAlumno;
        vm.agregarAlumno = agregarAlumno;
        vm.eliminar=eliminar;
        vm.Init = Init;
        vm.datos_alumnos = [];
        vm.id = "";
        vm.alumno = {};
        vm.addAlumno = {};
        vm.objAlumno = {};
        vm.login=login;
        vm.pdf=pdf;
        vm.loginActivo=false;
        vm.valor=false;
        vm.log=[];
        vm.entrar=false;
        vm.mostrarDatos=false;
        vm.valMosAlumno=true;
        vm.datos_alumnos=[];

        Init();
        function Init() {
            getAlumnos();
        }

        function login() {
            console.log(vm.user +'--'+vm.password);
            servicioalumno.login(vm.user, vm.password).then(function(data) {
                vm.log = data;
                 vm.loginActivo=true;
                 vm.entrar=true;
                console.log(vm.log);
            });
        }
        function prueba(){
            var body=[];
            for(var i=0; i<vm.datos_alumnos.length; i++){
                    var arr= [
                                {
                                    text: vm.datos_alumnos[i].nombre, border: [true, true, true, true],
                                     fontSize: 10,
                                }
                                    ,{
                                    text: vm.datos_alumnos[i].apellido_paterno, border: [true, true, true, true],
                                     fontSize: 10,
                                },
                                {
                                    text: vm.datos_alumnos[i].apellido_materno,
                                    border: [true, true, true, true],
                                    fontSize: 10,
                                },
                                 {
                                    text: vm.datos_alumnos[i].genero,  border: [true, true, true, true],
                                    fontSize: 10,
                                },
                                {
                                    text: vm.datos_alumnos[i].correo,  border: [true, true, true, true],
                                    fontSize: 10,
                                },
                                
                                
                        ]
                        body.push(arr);
            }
            return body;
        }
        function pdf() {
            var pdf_salida = {
                content: [

                     {   
                       fontSize: 10,
                        margin: [0, 0, 0, 0],
                        //alignment: 'center',
                        table: {
                             widths: ['100%'],
                            body:[  
                            [{
                                text: 'LISTA DE ALUMNOS',
                                border: [false, false, false, false],
                                alignment: 'center',
                                bold: true
                            }]
                        ]}
                    },
                     {   
                       fontSize: 10,
                        margin: [0, 0, 0, 0],
                        table: {
                             widths: ['20%','20%','20%','10%','30%'],
                            body:[  
                                         [
                                    {
                                        text: 'nombre', border: [true, true, true, true],
                                         fontSize: 10, bold: true,
                                    }
                                        ,{
                                        text: 'apPaterno', border: [true, true, true, true],
                                         fontSize: 10, bold: true,
                                    },
                                    {
                                     text: 'apMaterno ',
                                        border: [true, true, true, true],
                                            fontSize: 10,
                                        bold: true,
                                    },
                                     {
                                        text: 'genero ',  border: [true, true, true, true], bold: true,
                                    },
                                    {
                                        text: ' correo',  border: [true, true, true, true], bold: true,
                                    },         
                            ]
                        ]
                            
                        }
                    },
                    {   
                       fontSize: 8,
                        margin: [0, 0, 0, 0],
                        //alignment: 'center',
                        table: {
                                 widths: ['20%','20%', '20%','10%', '30%'],
                            body: prueba()
                        }
                    },
                ]

            };
            pdfMake.createPdf(pdf_salida).open();
        }
        function eliminar(id){
             console.log("Eliminando alumno");
            servicioalumno.eliminar(id).then(function(data) {
                getAlumnos()
            }).catch(function(err) {
                getAlumnos();
            });
        }
        function getAlumnos() {
            console.log("Alumnos");
            servicioalumno.getAlumno().then(function(data) {
                vm.datos_alumnos = data;
                console.log(vm.datos_alumnos);
            }).catch(function(err) {});
        }

        function getAlumnoById(id) {
            servicioalumno.getAlumnoById(id).then(function(data) {
                vm.alumno = data[0];
                vm.valor=true;
                console.log(vm.alumno);
            }).catch(function(err) {});
        }

        function updateAlumno() {
            console.log(vm.alumno);
            servicioalumno.updateAlumno(vm.alumno).then(function(data) {
                vm.alumno = data;
                getAlumnos();
                vm.valor=false;
                console.log("Se actualizo");
               
            })
        }

        function agregarAlumno(obj) {
            console.log(obj);
            servicioalumno.addAlumno(obj).then(function(data) {
                vm.addAlumno = data;
                console.log(vm.addAlumno);
                alert("usuario agregador");
            })
        }
    }
})();